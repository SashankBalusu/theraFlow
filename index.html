<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Theraflow</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/logo.jpg" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Raleway:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet">
  <!-- Template Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Impact - v1.2.0
  * Template URL: https://bootstrapmade.com/impact-bootstrap-business-website-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->


  <header id="header" class="header d-flex align-items-center">

    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 style = "font-family: 'Kaushan Script', cursive">Theraflow<span>.</span></h1>
      </a>
      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="#hero" style = "color: white; font-family: 'Kaushan Script', cursive">Home</a></li>
          <li><a id = "googleSign" style = "color: white; font-family: 'Kaushan Script', cursive">Sign In</a></li>

        </ul>
      </nav><!-- .navbar -->

      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>

    </div>
  </header><!-- End Header -->
  <!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="hero">
    <div class="container position-relative">
      <div class="row gy-5" data-aos="fade-in">
        <div class="col-lg-6 order-2 order-lg-1 d-flex flex-column justify-content-center text-center text-lg-start">
          <h2>Welcome to <span>Theraflow</span></h2>
          <p style = "font-family: Segoe UI">Flow through your physical therapy.</p>
          <div class="d-flex justify-content-center justify-content-lg-start">
            <a id = "googleSign" class="btn-get-started">Get Started</a>
          </div>
        </div>
        <div class="col-lg-6 order-1 order-lg-2">
          <img src="assets/img/hero-img.svg" class="img-fluid" alt="" data-aos="zoom-out" data-aos-delay="100">
        </div>
      </div>
    </div>

    <div class="icon-boxes position-relative" style = "margin-top: -7%;">
      <div class="container position-relative">
        <div class="row gy-4 mt-5">

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-easel"></i></div>
              <h4 class="title"><a href="" class="stretched-link">Manage Patients</a></h4>
            </div>
          </div>
          <!--End Icon Box -->

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-gem"></i></div>
              <h4 class="title"><a href="" class="stretched-link">Graph Data</a></h4>
            </div>
          </div>
          <!--End Icon Box -->

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="300">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-geo-alt"></i></div>
              <h4 class="title"><a href="" class="stretched-link">Analyze Progress</a></h4>
            </div>
          </div>
          <!--End Icon Box -->

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="500">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-command"></i></div>
              <h4 class="title"><a href="" class="stretched-link">De Injure</a></h4>
            </div>
          </div>
          <!--End Icon Box -->

        </div>
      </div>
    </div>

    </div>
  </section>
  <!-- End Hero Section -->

  

  

  <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js"; 


    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAiJQQtF-g05oTrM3MZor-jEC4uXDJWP7Y",
      authDomain: "theraflow-cb0cc.firebaseapp.com",
      projectId: "theraflow-cb0cc",
      storageBucket: "theraflow-cb0cc.appspot.com",
      messagingSenderId: "654850056739",
      appId: "1:654850056739:web:39ba1ec0a5f4c14c920796",
      measurementId: "G-JQ48XH19CT"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

const auth = getAuth();
const googleSign = document.querySelectorAll("#googleSign")
let user
for (let i = 0; i < googleSign.length; i++){
  googleSign[i].addEventListener("click", function(){
    signInWithPopup(auth, provider)
    .then(async function (result) {
      // This gives you a Google Access Token. You can use it to access the Google API.
      const credential = GoogleAuthProvider.credentialFromResult(result);
      //console.log(credential)
      const token = credential.accessToken;
      // The signed-in user info.
      
      user = result.user;
      console.log(user)
      let newUser = false;
      if (JSON.stringify(user["metadata"]["creationTime"]) == JSON.stringify(user["metadata"]["lastSignInTime"])){
        newUser = true
      }
      console.log(newUser)
      let displayName = user["displayName"]
      let id = Math.floor(100000 + Math.random() * 900000)
      console.log(id)
      localStorage.setItem("displayName", JSON.stringify(displayName))
      localStorage.setItem("id", id.toString())

      localStorage.setItem("email", JSON.stringify(user["email"]))
      localStorage.setItem("emailVerified", JSON.stringify(user["emailVerified"]))
      localStorage.setItem("phoneNumber", JSON.stringify(user["phoneNumber"]))
      localStorage.setItem("photoURL", JSON.stringify(user["photoURL"]))
      localStorage.setItem("creationTime", JSON.stringify(user["metadata"]["creationTime"]))
      localStorage.setItem("lastSignInTime", JSON.stringify(user["metadata"]["lastSignInTime"]))
      //lastSignInTime
      let email = user["email"]
      console.log(email)
      if (newUser == true){
        await setDoc(doc(db, "therapists", email), {
        name: displayName,
        email: user["email"],
        emailVerified: user["emailVerified"],
        phoneNumber: user["phoneNumber"],
        photoURL: user["photoURL"],
        creationTime: user["metadata"]["creationTime"],
        id: id

        })
      }
      window.open("dash/index.html", "_self")

      
      
      
      //console.log(result.additionalUserInfo.isNewUser)

    //   const database = getDatabase(app);
    //   get(ref(database, "doctors/")).then((info) => {
    //     if (info.exists()){
    //     console.log("hi")

    //       let doctors = info.val()

    //       let userExistsFlag = false
    //       for (let key in doctors){
    //           if (key == displayName){
    //               userExistsFlag = true
    //               console.log(doctors[key]["id"])
    //               localStorage.setItem("doctorID", JSON.stringify(doctors[key]["id"]))
                  
    //           }
    //       }
    //       if (userExistsFlag == false){
    //         let docID = getRandomInt(100000, 999999)
    //         localStorage.setItem("doctorID", JSON.stringify(docID))

    //         set(ref(database, `doctors/${displayName}/`), {
    //             id: String(docID),
    //             patientIDs: ["PLACEHOLDER REMOVE"],
                
    //           });

    //       }
    //       window.open("home.html", "_self")
          
    //     }

        
    //   }).catch((error) => {
    //       console.log(error);
    //   });
    //   //console.log(user)
    //   //...
    // }).catch((error) => {
    //   // Handle Errors here.
    //   const errorCode = error.code;
    //   const errorMessage = error.message;
    //   console.log(errorMessage)

    //   // The email of the user's account used.
    //   const email = error.email;
    //   // The AuthCredential type that was used.
    //   const credential = GoogleAuthProvider.credentialFromError(error);
    //   // ...
    // });
})
})
}

  </script>
</body>

</html>